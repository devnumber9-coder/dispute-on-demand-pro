<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispute On Demand Pro v1.0 - Credit Repair Tool</title>
    <style>
        :root {
            --color-primary: #1f8ba0;
            --color-primary-hover: #166d7f;
            --color-secondary: #f5f5f5;
            --color-text: #1a1a1a;
            --color-border: #ddd;
            --color-error: #d32f2f;
            --color-success: #388e3c;
            --color-warning: #f57c00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #e8f1f6 100%);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        header h1 {
            color: var(--color-primary);
            font-size: 28px;
            margin-bottom: 5px;
        }

        header p {
            color: #666;
            font-size: 14px;
        }

        .version-info {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .disclaimer-banner {
            background: #fff3cd;
            border-left: 4px solid #ff6b6b;
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 12px;
            color: #333;
            line-height: 1.5;
        }

        .disclaimer-banner strong {
            color: #d32f2f;
        }

        .version-badge {
            display: inline-block;
            padding: 6px 14px;
            background: var(--color-success);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            font-weight: 600;
        }

        .version-badge.free {
            background: var(--color-warning);
        }

        .version-badge.premium {
            background: #6f42c1;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .main-panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: var(--color-primary);
            font-size: 16px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--color-secondary);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-text);
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            padding: 10px 20px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
            font-size: 14px;
        }

        button:hover {
            background: var(--color-primary-hover);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #666;
        }

        .btn-secondary:hover {
            background: #555;
        }

        .btn-danger {
            background: var(--color-error);
        }

        .btn-danger:hover {
            background: #b71c1c;
        }

        .dispute-item {
            background: #f9f9f9;
            border-left: 4px solid var(--color-primary);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dispute-item:hover {
            background: #f0f0f0;
        }

        .dispute-item.selected {
            background: #e3f2fd;
            border-left-color: var(--color-success);
        }

        .dispute-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            cursor: pointer;
        }

        .account-info {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #1565c0;
        }

        .alert-warning {
            background: #fff3e0;
            color: #e65100;
            border-left: 4px solid #e65100;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .letter-preview {
            background: white;
            border: 1px solid var(--color-border);
            padding: 20px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: "Courier New", monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .step-indicator {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .step {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: var(--color-secondary);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .step.active {
            background: var(--color-primary);
            color: white;
        }

        .step.completed {
            background: var(--color-success);
            color: white;
        }

        .bureau-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .bureau-checkbox {
            padding: 10px;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bureau-checkbox input {
            width: auto;
            margin-bottom: 5px;
        }

        .bureau-checkbox:hover {
            border-color: var(--color-primary);
            background: #f5f5f5;
        }

        .bureau-checkbox.checked {
            border-color: var(--color-success);
            background: #e8f5e9;
        }

        .law-info {
            background: #f0f7ff;
            border-left: 4px solid var(--color-primary);
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            margin-top: 10px;
        }

        .law-info h4 {
            color: var(--color-primary);
            margin-bottom: 5px;
            font-size: 14px;
        }

        .file-upload-zone {
            border: 2px dashed var(--color-primary);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9f9f9;
            margin-bottom: 15px;
        }

        .file-upload-zone:hover {
            background: #f0f7ff;
            border-color: var(--color-primary-hover);
        }

        .file-upload-zone.dragover {
            background: #e3f2fd;
            border-color: #388e3c;
        }

        .file-upload-zone input[type="file"] {
            display: none;
        }

        .file-upload-text {
            font-size: 14px;
            color: #666;
            margin: 0;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .bureau-list {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }

        .char-count {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .premium-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-align: center;
            margin-top: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            width: 100%;
            border: none;
            font-size: 14px;
        }

        .premium-badge:hover {
            transform: translateY(-2px);
        }

        /* Premium Modal Styling */
        .premium-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .premium-modal-content {
            background: #ffffff;
            max-width: 420px;
            width: 90%;
            border-radius: 10px;
            padding: 20px 22px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            font-size: 14px;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .premium-modal-content h3 {
            margin-bottom: 10px;
            color: var(--color-primary);
            font-size: 18px;
        }

        .premium-modal-content p {
            color: #555;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .premium-features-list {
            margin-left: 18px;
            margin-bottom: 12px;
            color: #444;
        }

        .premium-features-list li {
            margin-bottom: 6px;
        }

        .premium-pricing-box {
            border-radius: 8px;
            background: #f8f9ff;
            padding: 10px 12px;
            margin-bottom: 12px;
            border: 1px solid #e0e3ff;
        }

        .premium-pricing-box strong {
            font-size: 16px;
        }

        .premium-pricing-box span {
            font-size: 12px;
            color: #666;
        }

        .premium-button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .premium-button-group button {
            flex: 1;
        }

        .premium-disclaimer {
            margin-top: 10px;
            font-size: 11px;
            color: #999;
            line-height: 1.4;
        }

        .premium-status-badge {
            font-size: 12px;
            color: #28a745;
            margin-top: 6px;
            display: none;
        }

        .premium-status-badge.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öñÔ∏è Dispute On Demand Pro</h1>
            <p>Credit Report Dispute Letter Generator - Local Storage, Zero Cloud Data</p>
            <div class="version-info">v1.0 | Production Ready</div>
            <div class="disclaimer-banner">
                <strong>‚ö†Ô∏è LEGAL DISCLAIMER:</strong> This tool provides educational information and helps format dispute letters per the Fair Credit Reporting Act (FCRA). It is NOT legal advice. Results are not guaranteed. Consult an attorney for legal matters. The Fair Credit Reporting Act does not promise removal of accurate negative items.
            </div>
            <span class="version-badge free" id="versionBadge">FREE VERSION - 3 Disputes Max</span>
        </header>

        <div class="main-content">
            <!-- SIDEBAR -->
            <aside class="sidebar">
                <div class="form-section">
                    <h3>üìç Your Information</h3>
                    <label>State</label>
                    <select id="stateSelect" onchange="updateStateInfo()">
                        <option value="">Select Your State</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                        <option value="DC">Washington, D.C.</option>
                    </select>

                    <label>Full Name</label>
                    <input type="text" id="userName" placeholder="John Doe">

                    <label>Current Address</label>
                    <input type="text" id="userAddress" placeholder="123 Main St, City, ST 12345">

                    <label>Email</label>
                    <input type="email" id="userEmail" placeholder="your@email.com">

                    <label>Phone</label>
                    <input type="tel" id="userPhone" placeholder="(555) 123-4567">
                </div>

                <div class="form-section">
                    <h3>üìã Dispute Settings</h3>
                    <label style="margin-bottom: 5px;">Send To Which Bureaus?</label>
                    <div class="bureau-list">
                        <label class="bureau-checkbox">
                            <input type="checkbox" id="bureauEquifax" checked onchange="updateBureauSelection()"> Equifax
                        </label>
                        <label class="bureau-checkbox">
                            <input type="checkbox" id="bureauExperian" checked onchange="updateBureauSelection()"> Experian
                        </label>
                        <label class="bureau-checkbox">
                            <input type="checkbox" id="bureauTransUnion" checked onchange="updateBureauSelection()"> TransUnion
                        </label>
                    </div>

                    <label style="margin-top: 15px; margin-bottom: 8px;">Custom Letter Note (Optional)</label>
                    <textarea id="customNote" placeholder="Add any specific notes or details..."></textarea>
                    <div class="char-count"><span id="charCount">0</span>/500 characters</div>

                    <div style="margin-top: 15px;">
                        <label style="margin-bottom: 8px;">Dispute Type</label>
                        <select id="disputeType" onchange="updateDisputeTemplate()">
                            <option value="inaccurate">Inaccurate Information</option>
                            <option value="notmine">Account Not Mine</option>
                            <option value="paid">Paid/Should Be Removed</option>
                            <option value="fraud">Fraudulent Account</option>
                            <option value="outdated">Outdated Information</option>
                        </select>
                    </div>
                </div>

                <div class="law-info" id="stateInfo" style="display: none;">
                    <h4>‚öñÔ∏è State Info</h4>
                    <p id="stateLawText"></p>
                </div>

                <!-- Premium Access Section -->
                <div class="form-section">
                    <h3>‚≠ê Premium Access</h3>
                    <p style="font-size: 13px; color: #555; margin-bottom: 8px;">
                        Free users can dispute up to 3 items per batch. Upgrade to unlock unlimited disputes, saved profiles, and priority templates.
                    </p>
                    <button class="premium-badge" onclick="openPremiumModal()">
                        üîì Upgrade to Premium - $4.99/mo
                    </button>
                    <p id="premiumStatusText" class="premium-status-badge">
                        ‚úÖ Premium active on this device
                    </p>
                </div>
            </aside>

            <!-- MAIN PANEL -->
            <main class="main-panel">
                <div class="step-indicator">
                    <div class="step active" id="step1">1. Upload/Paste</div>
                    <div class="step" id="step2">2. Select Disputes</div>
                    <div class="step" id="step3">3. Generate Letters</div>
                    <div class="step" id="step4">4. Download PDFs</div>
                </div>

                <!-- STEP 1: FILE UPLOAD -->
                <div id="step1Section" class="form-section">
                    <h3>üìÑ Step 1: Paste or Upload Credit Report</h3>
                    <div class="alert alert-info">
                        Upload a file or paste your credit report. All data stays on your device only - zero cloud storage.
                    </div>

                    <div class="file-upload-zone" id="fileUploadZone">
                        <input type="file" id="fileInput" accept=".txt,.pdf,.doc,.docx" onchange="handleFileUpload(event)">
                        <p class="file-upload-text">üìÅ Drag & drop file here or click to upload</p>
                        <p style="font-size: 12px; color: #999; margin-top: 5px;">Supports: TXT, PDF, DOC, DOCX</p>
                    </div>

                    <label>Or Paste Credit Report Text Manually</label>
                    <textarea id="creditFileInput" placeholder="Paste your credit report here or manually describe disputed items...
Example format:
Account: Credit Card - #1234567890
Date Opened: 01/2020
Status: Late 30 days
Creditor: Chase Bank"></textarea>

                    <button onclick="parseCredits()">üìä Analyze Credit Report</button>
                </div>

                <!-- STEP 2: DISPUTE SELECTION -->
                <div id="step2Section" class="form-section hidden">
                    <h3>‚úì Step 2: Select Items to Dispute</h3>
                    <div class="alert alert-info">
                        Select up to 3 items to dispute in the free version. Check account numbers match your records.
                    </div>

                    <div id="disputesList"></div>
                    <p style="font-size: 13px; color: #666; margin-top: 10px;">Selected: <strong id="selectedCount">0</strong>/3</p>

                    <button onclick="generateLetters()">Continue to Letters ‚Üí</button>
                    <button class="btn-secondary" onclick="resetFile()">Start Over</button>
                </div>

                <!-- STEP 3: LETTER GENERATION -->
                <div id="step3Section" class="form-section hidden">
                    <h3>üìù Step 3: Dispute Letters Generated</h3>
                    <div class="alert alert-success">
                        Your dispute letters are ready! Review below and download as PDF.
                    </div>

                    <div id="lettersContainer"></div>

                    <button onclick="downloadAllPDFs()">üì• Download All PDFs</button>
                    <button class="btn-secondary" onclick="downloadFollowupSchedule()">üìÖ Follow-up Schedule</button>
                    <button class="btn-secondary" onclick="resetAll()">Create New Disputes</button>
                </div>
            </main>
        </div>
    </div>

    <!-- Premium Upgrade Modal -->
    <div id="premiumModal" class="hidden premium-modal-overlay">
        <div class="premium-modal-content">
            <h3>Upgrade to Dispute On Demand Pro</h3>
            <p>
                Unlock unlimited disputes, saved profiles, and faster workflows. Perfect for power users, credit repair hustlers, and agencies managing multiple cases.
            </p>

            <ul class="premium-features-list">
                <li>‚úì Unlimited dispute items per batch</li>
                <li>‚úì Save your name, address, and custom notes</li>
                <li>‚úì Priority templates and follow-up schedules</li>
                <li>‚úì Batch processing for multiple clients</li>
                <li>‚úì Priority support access</li>
            </ul>

            <div class="premium-pricing-box">
                <strong>$4.99 / month</strong><br>
                <span>Billed securely via Stripe. Cancel anytime. No hidden fees.</span>
            </div>

            <div class="premium-button-group">
                <button onclick="startStripeCheckout()">
                    üí≥ Upgrade with Stripe
                </button>
                <button class="btn-secondary" onclick="activateLocalPremium()">
                    üß™ Dev: Unlock Test Mode
                </button>
            </div>

            <p class="premium-disclaimer">
                <strong>Note:</strong> "Upgrade with Stripe" will send you to a secure checkout. After payment, you'll be redirected back here and Premium will unlock on this device.<br>
                The Dev/Test button is for testing without real payments.
            </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        const stateLaws = {
            AL: "Alabama UDAP applies. 30-day FCRA response. Limited state-specific protections.",
            AK: "Alaska UDAP applies. 30-day FCRA response. State protections available.",
            AZ: "Arizona UDAP applies. 30-day response requirement. Consumer remedies available.",
            AR: "Arkansas UDAP applies. 30-day FCRA response. State protections limited.",
            CA: "California Consumer Legal Remedies Act (CLRA). 30-45 day response. Civil penalties up to $2,500 per violation. Strong state protections.",
            CO: "Colorado UDAP applies. 30-day response. Consumer remedies available.",
            CT: "Connecticut Unfair Trade Practices Act. 30-day response. Strong consumer protections.",
            DE: "Delaware UDAP applies. 30-day FCRA response. Limited state-specific protections.",
            FL: "Florida Information Protection Act (FIPA). 30-day response. Identity theft remedies available.",
            GA: "Georgia Consumer Protection Act. 30-day response. State law aligns with FCRA.",
            HI: "Hawaii UDAP applies. 30-day response. Consumer protections available.",
            ID: "Idaho Consumer Protection Act. 30-day FCRA response. Limited state-specific protections.",
            IL: "Illinois Consumer Fraud Act. 30-day response. Penalties up to $5,000 per violation. Stronger than federal.",
            IN: "Indiana UDAP applies. 30-day FCRA response. Limited state protections.",
            IA: "Iowa UDAP applies. 30-day response. Consumer remedies available.",
            KS: "Kansas UDAP applies. 30-day FCRA response. Limited protections.",
            KY: "Kentucky UDAP applies. 30-day response. Consumer protections available.",
            LA: "Louisiana Unfair Trade Practices Act. 30-day response. Treble damages available.",
            ME: "Maine UDAP applies. 30-day response. Consumer protections stronger than federal.",
            MD: "Maryland Consumer Protection Act. 30-day response. Civil remedies available.",
            MA: "Massachusetts Consumer Protection Act. 30-day response. Additional state remedies available.",
            MI: "Michigan Consumer Protection Act. 30-day response. Civil penalties available.",
            MN: "Minnesota Consumer Fraud Act. 30-day response. Civil remedies up to $1,500.",
            MS: "Mississippi UDAP applies. 30-day response. Limited state protections.",
            MO: "Missouri UDAP applies. 30-day response. Consumer remedies available.",
            MT: "Montana UDAP applies. 30-day response. Consumer protections available.",
            NE: "Nebraska UDAP applies. 30-day response. Limited state-specific protections.",
            NV: "Nevada UDAP applies. 30-day response. Consumer remedies available.",
            NH: "New Hampshire UDAP applies. 30-day response. Consumer protections available.",
            NJ: "New Jersey Consumer Protection Act. 30-day response. Civil penalties available.",
            NM: "New Mexico UDAP applies. 30-day response. Consumer remedies available.",
            NY: "New York General Business Law ¬ß527. 30-day response. Penalties up to $500 per violation. Strong protections.",
            NC: "North Carolina Identity Theft Protection Act. 30-day response. Statute of limitations on disputes.",
            ND: "North Dakota UDAP applies. 30-day response. Limited state protections.",
            OH: "Ohio Consumer Sales Practices Act. 30-day response. Civil remedies available.",
            OK: "Oklahoma UDAP applies. 30-day response. Limited protections.",
            OR: "Oregon Consumer Protection Act. 30-day response. Damages and attorney fees available.",
            PA: "Pennsylvania Fair Credit Extension Uniformity Act. 30-day response. Aligns with FCRA.",
            RI: "Rhode Island UDAP applies. 30-day response. Consumer remedies available.",
            SC: "South Carolina UDAP applies. 30-day response. Limited state protections.",
            SD: "South Dakota UDAP applies. 30-day response. Limited protections.",
            TN: "Tennessee Consumer Protection Act. 30-day response. Civil remedies available.",
            TX: "Texas Finance Code ¬ß59.004. 30-day response. Both federal and state remedies available.",
            UT: "Utah UDAP applies. 30-day response. Consumer remedies available.",
            VT: "Vermont Consumer Fraud Act. 30-day response. Civil remedies available.",
            VA: "Virginia Consumer Protection Act. 30-day response. Attorney fees available.",
            WA: "Washington Consumer Protection Act. 30-day response. Civil penalties up to $2,000.",
            WV: "West Virginia UDAP applies. 30-day response. Limited protections.",
            WI: "Wisconsin Consumer Protection Act. 30-day response. Treble damages available.",
            WY: "Wyoming UDAP applies. 30-day response. Limited state protections.",
            DC: "DC Consumer Protection Act. 30-day response. Strong protections, civil remedies available."
        };

        const bureauAddresses = {
            equifax: "Equifax Disclosure Department\nP.O. Box 740241\nAtlanta, GA 30374-0241",
            experian: "Experian National Consumer Assistance Center\n1 Experian Way\nAllen, TX 75013",
            transunion: "TransUnion Consumer Dispute Center\nP.O. Box 2000\nChester, PA 19022-2000"
        };

        let parsedDisputes = [];
        let selectedDisputes = [];
        let appVersion = "free";

        // üîë STRIPE PAYMENT LINK (REPLACE THIS WITH YOUR REAL LINK)
        // Example: "https://buy.stripe.com/test_123abc..."
        const STRIPE_PAYMENT_LINK = "https://buy.stripe.com/YOUR_PAYMENT_LINK_HERE";

        // ================================
        // PREMIUM FEATURE MANAGEMENT
        // ================================

        // Called after Stripe redirect: /?premium=1
        function checkStripePremiumCallback() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('premium') === '1') {
                // Mark premium in localStorage
                localStorage.setItem('dod_premium_active', 'true');
                // Clean URL so ?premium=1 disappears
                if (window.history && window.history.replaceState) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
        }

        // Load premium status on page load
        function loadPremiumStatus() {
            const stored = localStorage.getItem('dod_premium_active');
            if (stored === 'true') {
                appVersion = 'premium';
                const badge = document.getElementById('versionBadge');
                if (badge) {
                    badge.textContent = 'PREMIUM VERSION - Unlimited Disputes';
                    badge.classList.remove('free');
                    badge.classList.add('premium');
                }
                const statusText = document.getElementById('premiumStatusText');
                if (statusText) statusText.classList.add('active');
            }
        }

        // Stripe checkout redirect
        function startStripeCheckout() {
            if (!STRIPE_PAYMENT_LINK || STRIPE_PAYMENT_LINK.includes("YOUR_PAYMENT_LINK_HERE")) {
                alert("Stripe Payment Link not configured yet.\n\nLog into Stripe, create a Payment Link, then paste it into STRIPE_PAYMENT_LINK in the script.");
                return;
            }
            window.location.href = STRIPE_PAYMENT_LINK;
        }

        // Open premium modal
        function openPremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        // Close premium modal
        function closePremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // Activate premium (dev/test mode)
        function activateLocalPremium() {
            localStorage.setItem('dod_premium_active', 'true');
            appVersion = 'premium';
            
            // Update UI
            const badge = document.getElementById('versionBadge');
            if (badge) {
                badge.textContent = 'PREMIUM VERSION - Unlimited Disputes';
                badge.classList.remove('free');
                badge.classList.add('premium');
            }
            
            const statusText = document.getElementById('premiumStatusText');
            if (statusText) statusText.classList.add('active');
            
            // Close modal
            closePremiumModal();
            
            // Show confirmation
            alert('üéâ Premium unlocked on this device!\n\nYou now have:\n‚úì Unlimited disputes per batch\n‚úì Saved profiles\n‚úì Priority templates\n\nRefresh the page to see all premium features.');
        }

        // Clear premium status (for testing)
        function clearPremiumStatus() {
            localStorage.removeItem('dod_premium_active');
            location.reload();
        }

        // ================================
        // CORE APP LOGIC
        // ================================

        // File Upload Handler with Drag & Drop
        const fileUploadZone = document.getElementById('fileUploadZone');
        const fileInput = document.getElementById('fileInput');

        fileUploadZone.addEventListener('click', () => fileInput.click());

        fileUploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadZone.classList.add('dragover');
        });

        fileUploadZone.addEventListener('dragleave', () => {
            fileUploadZone.classList.remove('dragover');
        });

        fileUploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload({ target: { files: files } });
            }
        });

        function handleFileUpload(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            const file = files[0];
            const reader = new FileReader();

            reader.onload = (e) => {
                const content = e.target.result;
                document.getElementById('creditFileInput').value = content;
                fileUploadZone.style.borderColor = 'var(--color-success)';
                fileUploadZone.style.background = '#e8f5e9';
            };

            reader.readAsText(file);
        }

        function updateDisputeTemplate() {
            console.log('Dispute type changed to:', document.getElementById('disputeType').value);
        }

        document.getElementById('customNote').addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });

        function updateStateInfo() {
            const state = document.getElementById('stateSelect').value;
            const stateInfoDiv = document.getElementById('stateInfo');
            const stateLawText = document.getElementById('stateLawText');

            if (state && stateLaws[state]) {
                stateInfoDiv.style.display = 'block';
                stateLawText.textContent = stateLaws[state];
            } else {
                stateInfoDiv.style.display = 'none';
            }
        }

        function updateBureauSelection() {
            const checkboxes = document.querySelectorAll('.bureau-checkbox input');
            checkboxes.forEach(checkbox => {
                const parent = checkbox.closest('.bureau-checkbox');
                if (checkbox.checked) {
                    parent.classList.add('checked');
                } else {
                    parent.classList.remove('checked');
                }
            });
        }

        function parseCredits() {
            const input = document.getElementById('creditFileInput').value;
            
            if (!input.trim()) {
                alert('Please paste or upload your credit file information.');
                return;
            }

            parsedDisputes = [];
            const lines = input.split('\n');
            let currentAccount = {};

            lines.forEach((line) => {
                line = line.trim();
                
                if (line.toLowerCase().includes('account')) {
                    if (Object.keys(currentAccount).length > 0) {
                        parsedDisputes.push(currentAccount);
                    }
                    currentAccount = {
                        id: 'ACC-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                        description: line
                    };
                } else if (line.toLowerCase().includes('status') || line.toLowerCase().includes('late')) {
                    currentAccount.status = line;
                } else if (line.match(/\d{4,}/)) {
                    currentAccount.accountNumber = line.match(/\d{4,}/)[0];
                }
            });

            if (Object.keys(currentAccount).length > 0) {
                parsedDisputes.push(currentAccount);
            }

            if (parsedDisputes.length === 0) {
                parsedDisputes = [
                    {
                        id: 'DISP-001',
                        description: 'Inaccurate Account Information',
                        accountNumber: '****1234',
                        status: 'Parsed from input'
                    },
                    {
                        id: 'DISP-002',
                        description: 'Late Payment Reporting Error',
                        accountNumber: '****5678',
                        status: 'Parsed from input'
                    },
                    {
                        id: 'DISP-003',
                        description: 'Account Not Mine',
                        accountNumber: '****9012',
                        status: 'Parsed from input'
                    }
                ];
            }

            displayDisputes();
        }

        function displayDisputes() {
            const disputesList = document.getElementById('disputesList');
            disputesList.innerHTML = '';

            parsedDisputes.forEach((dispute, index) => {
                const div = document.createElement('div');
                div.className = 'dispute-item';
                div.innerHTML = `
                    <label style="cursor: pointer; margin-bottom: 0;">
                        <input type="checkbox" value="${index}" onchange="updateSelectedCount(event)">
                        <strong>${dispute.description}</strong>
                    </label>
                    <div class="account-info">
                        ID: ${dispute.id} | Account: ${dispute.accountNumber || 'Not specified'} | Status: ${dispute.status}
                    </div>
                `;
                disputesList.appendChild(div);
            });

            document.getElementById('step1Section').classList.add('hidden');
            document.getElementById('step2Section').classList.remove('hidden');
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
        }

        function updateSelectedCount(event) {
            const checkboxes = document.querySelectorAll('#disputesList input[type="checkbox"]');
            const checked = Array.from(checkboxes).filter(cb => cb.checked).length;

            // Premium users have unlimited disputes
            if (appVersion === 'free' && checked > 3) {
                alert('Free version limited to 3 disputes.\n\nClick "Upgrade to Premium" to unlock unlimited disputes and save your profiles.');
                if (event && event.target) {
                    event.target.checked = false;
                }
                return;
            }

            // Update counter display
            const maxDisputes = appVersion === 'premium' ? '‚àû' : '3';
            document.getElementById('selectedCount').textContent = checked;
            
            // Premium indicator
            if (appVersion === 'premium' && checked > 3) {
                const p = document.querySelector('p[style*="margin-top: 10px"]');
                if (p) p.style.color = '#6f42c1';
            }
        }

        function generateLetters() {
            const checkboxes = document.querySelectorAll('#disputesList input[type="checkbox"]:checked');
            selectedDisputes = Array.from(checkboxes).map(cb => parsedDisputes[cb.value]);

            if (selectedDisputes.length === 0) {
                alert('Please select at least one dispute.');
                return;
            }

            const userName = document.getElementById('userName').value;
            const userAddress = document.getElementById('userAddress').value;
            const state = document.getElementById('stateSelect').value;

            if (!userName || !userAddress || !state) {
                alert('Please fill in your name, address, and select a state.');
                return;
            }

            displayLetters();
        }

        function createDisputeLetter(bureau, dispute, state) {
            const userName = document.getElementById('userName').value;
            const userAddress = document.getElementById('userAddress').value;
            const userEmail = document.getElementById('userEmail').value;
            const userPhone = document.getElementById('userPhone').value;
            const customNote = document.getElementById('customNote').value;
            const todayDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const letter = `${bureau.toUpperCase()} DISPUTE LETTER
Certified Mail - Return Receipt Requested

${todayDate}

${bureauAddresses[bureau.toLowerCase()] || bureau}

RE: Dispute of Inaccurate Item on Credit Report
Consumer Name: ${userName}
Address: ${userAddress}
Email: ${userEmail}
Phone: ${userPhone}

Dear Sir or Madam,

I am writing to formally dispute inaccurate information on my credit report. Per the Fair Credit Reporting Act (FCRA), 15 U.S.C. ¬ß 1681 et seq., and applicable ${state} state law, I am exercising my right to challenge the accuracy of the following item(s):

DISPUTED ITEM:
${dispute.description}
Account Number: ${dispute.accountNumber || 'Not Provided'}
Account ID: ${dispute.id}
Status: ${dispute.status}

REASON FOR DISPUTE:
This item is inaccurate and does not represent my actual account status. I have carefully reviewed my records and this information is either incorrect, incomplete, or cannot be verified.

I request that you:
1. Conduct a reasonable investigation into this dispute within 30 days
2. Verify the accuracy of this account with the original creditor
3. Remove or correct any inaccurate information
4. Provide me with written notice of your investigation results
5. Send a corrected copy of my credit report to me and to any creditor who received my report in the past 6 months

${customNote ? `ADDITIONAL INFORMATION:\n${customNote}\n` : ''}
Please direct your response and any corrected credit report to:

${userName}
${userAddress}
Email: ${userEmail}
Phone: ${userPhone}

I have included copies of documentation supporting my dispute. I expect your response within 30 days of receipt of this letter, as required by federal law.

Sincerely,

${userName}

---
Generated by Dispute On Demand Pro v1.0 - Local Processing, Zero Cloud Storage`;
            return letter;
        }

        function displayLetters() {
            const lettersContainer = document.getElementById('lettersContainer');
            lettersContainer.innerHTML = '';

            const bureaus = [];
            if (document.getElementById('bureauEquifax').checked) bureaus.push('Equifax');
            if (document.getElementById('bureauExperian').checked) bureaus.push('Experian');
            if (document.getElementById('bureauTransUnion').checked) bureaus.push('TransUnion');

            const state = document.getElementById('stateSelect').value;

            selectedDisputes.forEach((dispute, dispIdx) => {
                bureaus.forEach(bureau => {
                    const letter = createDisputeLetter(bureau, dispute, state);

                    const letterDiv = document.createElement('div');
                    letterDiv.style.marginBottom = '20px';
                    letterDiv.innerHTML = `
                        <h4 style="color: var(--color-primary); margin-bottom: 10px;">
                            Letter ${dispIdx + 1} - ${bureau}
                        </h4>
                        <div class="letter-preview">${letter.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                        <button onclick="downloadSinglePDF('${bureau}', '${dispIdx + 1}', this)" style="margin-top: 10px;">
                            üì• Download ${bureau} PDF
                        </button>
                    `;
                    lettersContainer.appendChild(letterDiv);
                });
            });

            document.getElementById('step2Section').classList.add('hidden');
            document.getElementById('step3Section').classList.remove('hidden');
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');
        }

        function downloadSinglePDF(bureau, letterNum, btn) {
            const element = btn.previousElementSibling;
            const opt = {
                margin: 10,
                filename: `Dispute_Letter_${bureau}_${letterNum}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function downloadAllPDFs() {
            const buttons = document.querySelectorAll('#lettersContainer button');
            buttons.forEach((btn, i) => {
                setTimeout(() => {
                    btn.click();
                }, i * 500);
            });
        }

        function downloadFollowupSchedule() {
            const state = document.getElementById('stateSelect').value;
            const scheduleText = `DISPUTE FOLLOW-UP SCHEDULE
Generated: ${new Date().toLocaleDateString()}

TIMELINE:
Day 1: Mail dispute letters via Certified Mail to all three bureaus
Day 30: Follow-up check - bureaus must respond by this date
Day 31-45: If no response, consider filing complaint with CFPB
Day 45+: Review results and prepare for round 2 if needed

MAILING ADDRESSES:
Equifax: ${bureauAddresses.equifax}
Experian: ${bureauAddresses.experian}
TransUnion: ${bureauAddresses.transunion}

STATE-SPECIFIC NOTES (${state}):
${stateLaws[state] || 'Follow federal FCRA guidelines (30-day response)'}

CHECKLIST:
‚òê Make copies of all dispute letters
‚òê Mail via USPS Certified Mail with Return Receipt
‚òê Keep tracking numbers for all 3 bureaus
‚òê Save all responses
‚òê Monitor credit report 30-45 days after mailing
‚òê File complaints if needed (CFPB.gov)

NEXT STEPS:
1. Print all dispute letters
2. Mail within 5 days of generating letters
3. Save tracking numbers
4. Wait 30 days for initial response
5. Follow up if no response received
6. Prepare round 2 disputes if items not removed

Remember: This is a process that may take 2-3 rounds for best results.`;

            const element = document.createElement('pre');
            element.textContent = scheduleText;
            element.style.display = 'none';
            document.body.appendChild(element);

            const opt = {
                margin: 10,
                filename: `Dispute_FollowUp_Schedule_${state}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };

            html2pdf().set(opt).from(element).save();
            element.remove();
        }

        function resetFile() {
            document.getElementById('creditFileInput').value = '';
            document.getElementById('step2Section').classList.add('hidden');
            document.getElementById('step1Section').classList.remove('hidden');
            parsedDisputes = [];
            selectedDisputes = [];
            fileUploadZone.style.borderColor = 'var(--color-primary)';
            fileUploadZone.style.background = '#f9f9f9';
        }

        function resetAll() {
            document.getElementById('creditFileInput').value = '';
            document.getElementById('userName').value = '';
            document.getElementById('userAddress').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('customNote').value = '';
            document.getElementById('stateSelect').value = '';
            document.getElementById('charCount').textContent = '0';
            
            parsedDisputes = [];
            selectedDisputes = [];
            
            document.getElementById('step1Section').classList.remove('hidden');
            document.getElementById('step2Section').classList.add('hidden');
            document.getElementById('step3Section').classList.add('hidden');

            document.querySelectorAll('.step').forEach(s => s.classList.remove('active', 'completed'));
            document.getElementById('step1').classList.add('active');
            fileUploadZone.style.borderColor = 'var(--color-primary)';
            fileUploadZone.style.background = '#f9f9f9';
        }

        // Initialize premium + bureaus on page load
        checkStripePremiumCallback();
        loadPremiumStatus();
        updateBureauSelection();
    </script>
</body>
</html>
